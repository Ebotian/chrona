### Chrono-Stasis 实现方案 2.0（零面积 Synthwave 版）

#### 0. 设计对齐概要

- **目标重申**：全站以《新构想 2.0》为唯一视觉蓝图，落实“零面积移动 + 合体线网 + Synthwave Skyline”三大原则。
- **复用与取舍**：
  - **保留**：`packages/tokens` 基础 token、UI 基础组件（GlowButton/HoloPanel/Heading 等）、`@chrono/motion` 粒子 shader 基线、音频 store。
  - **重构**：旧版 `HomeImmersionLayer`、`SloganCluster`、`AudioToggle`、文章卡片/详情页组件。
  - **新增**：线网核心库、Synthwave Skyline、Constellation Index、Floating Audio Rail、Scene Panels、Pulse Terminal 等。
- **优先级**：设计契合度第一；若既有实现阻碍线网/零面积要求，直接重写。

---

#### 1. 架构总览

- **Monorepo**：继续 `pnpm` + Turborepo；新增 `packages/line-net` 承载零面积线网内核。
- **Next.js 应用**：`apps/web` 仍使用 Next.js 15 App Router + React 19 + TypeScript 5；SSR/CSR 混合。
- **核心包职责**：
  - `packages/line-net`：线网 DSL、动画执行器、React Hooks。
  - `packages/tokens`：扩展合体线网、Synthwave 色彩、辉光、角度 token。
  - `packages/ui`：零面积兼容组件库（Scene Panel、Pulse Terminal、Dialogue Capsule 等）。
  - `packages/motion`：R3F 场景、Skyline 折线、音画同步工具。

---

#### 2. 线网与动画核心（packages/line-net）

- **功能**：
  - DSL：`defineLineNet({ nodes, edges, timelines })` 描述主干线与支线。
  - 渲染层：将 DSL 映射为 SVG/Canvas/R3F 边线，确保零面积绘制。
  - 动画执行器：基于 `gsap.timeline` + 自定义 easing，支持音画同步、节拍触发、Reduced Motion。
  - React Hooks：`useLineNetScene`, `useLineNetPlayback`, `useLineNetKeyboardNav` 等。
- **实现里程碑**：
  1. 建立 TypeScript 类型定义与验证。
  2. 提供 SSR 初始状态序列化，避免首屏跳动。
  3. Playground Demo（基于 `packages/motion`）验证。

---

#### 3. 现有资源改造

| 模块               | 当前状态               | 处理策略                                                                                                            |
| ------------------ | ---------------------- | ------------------------------------------------------------------------------------------------------------------- |
| HomeImmersionLayer | 旧版沉浸层             | 拆分为 Chrono Initiation Grid、Background Universe、Slogan Cluster 2.0、Floating Audio Rail；旧组件移至 `legacy/`。 |
| BackgroundCanvas   | 粒子云实现稳定         | 升级为 Background Universe：引入星云纹理、线网 uniform、音频驱动；保留核心 shader。                                 |
| SloganCluster      | Pointer reactive       | 沿主线重新设计，使用线网节点分段，CTA 改为线条长条。                                                                |
| AudioToggle        | 简单按钮               | 重构为 Floating Audio Rail（进度光点、波形）。                                                                      |
| Article Grid/Card  | CSS Grid 网格          | 替换为 Constellation Index + Scene Panels；旧网格组件移除。                                                         |
| MDX 组件           | 基础 SceneParagraph 等 | 扩展支持 LineNet 绑定、Pulse Terminal、Dialogue Capsule、Image Lab。                                                |

---

#### 4. 核心体验实现蓝图

##### 4.1 Chrono Initiation Grid（Preloader 升级）

- **步骤**：
  1. 线网 DSL 定义三条主线、左上 Chrono Glyph 节点。
  2. `gsap.timeline` 按阶段绘制：主线伸展 → Glyph 点亮 → 收束吸附。
  3. 与 Lost Years《Amplifier》节拍同步（`tone.js` Transport）。
  4. `prefers-reduced-motion` 走纯静态线网。
- **复用**：旧 Logo SVG 转换为 DSL 顶点数据；音频 store 继续使用。

##### 4.2 Background Universe

- **目标**：R3F 星云、粒子沿线段漂移，支持音频 FFT 与指针扰动。
- **实现**：
  - 复用 `NebulaParticlesScene` shader，加线路 uniform。
  - 使用 Webb 深场纹理 + Bloom 后处理。
  - 低配降级为静态 Canvas/SVG，线网仍由 CSS/SVG 表现。

##### 4.3 Synthwave Skyline

- **内容**：三层折线构建城市轮廓（太空针塔、双子塔等），12 秒循环零面积重绘，配两帧 glitch。
- **实现**：新增 `packages/motion/src/skyline`，输出 `useSynthwaveSkyline()` Hook；折线点位硬编码 + token 配色。

##### 4.4 Slogan Cluster 2.0

- **结构**：分段标题、描述、CTA 全部沿主线节点布置。
- **动画**：分段线框按序伸展，文字随线显现；指针驱动背后三角光束；CTA 点击沿线收束推动滚动。
- **技术**：`framer-motion` + `gsap`，CSS `border-image` + `clip-path` 实现零面积描边。

##### 4.5 Floating Audio Rail

- **结构**：左下线段播放条、进度光点、模式切换节点。
- **实现**：
  - 复用 `useAudioPreference` store；引入 `useAudioFFT` Hook。
  - Node 状态统一纳入线网 DSL；波形沿线震荡。
  - 移动端默认静音，Reduced Motion 时仅显示状态光点。

##### 4.6 Constellation Index & Timeline Beacon

- **目标**：主页下半部分星座式索引 + 全局垂直时间轴。
- **实现**：
  - 线网 DSL 定义径向主线；节点映射年份/专题。
  - Hover 展开条目沿支线下落；键盘导航按顺序遍历。
  - Timeline Beacon 常驻左侧主线，提供章节跳转。

##### 4.7 文章长卷组件

- **Scene Panels**：沿主线展开开口矩形框容纳正文，滚动驱动线段延伸回收。
- **Pulse Terminal**：代码块线框 + 复制按钮沿线连接；复用现有代码渲染逻辑。
- **Dialogue Capsules**：引用内容胶囊沿主线伸出；焦点状态沿线高亮。
- **Image Lab**：线网向两侧拉开形成舞台；R3F/Next Image 结合；提供滤镜切换。
- **Echo Chamber / Author Glyph**：评论与作者模块接入线网；使用音频事件驱动细微辉光。

---

#### 5. 内容与数据层升级

- **MDX Schema**：新增 `lineNetBindings`, `audioCues`, `glitchHints` 字段。
- **MDX Components**：导出 `<ScenePanel>`, `<PulseTerminal>`, `<DialogueCapsule>`, `<ChronoImageLab>` 等与线网绑定的组件。
- **Contentlayer**：更新生成器，确保每篇文章附带线网节点映射；后续接入 Sanity 时保证同结构。
- **音画同步**：`tone.js` Transport 控制 Skyline 刷新、背景辉光、CTA 强度。

---

#### 6. 阶段路线图

1. **Foundations Sprint（Week 1-2）**
   - `packages/line-net` 初版内核。
   - Tokens 扩展（线宽、角度、辉光、噪点、音频节拍）。
   - Playground 新增线网、Skyline Demo。
2. **Immersion Sprint（Week 3-4）**
   - Chrono Initiation Grid、Background Universe、Synthwave Skyline。
   - Slogan Cluster 2.0、Floating Audio Rail。
   - Reduced Motion/性能降级策略。
3. **Narrative Sprint（Week 5-6）**
   - Constellation Index、Timeline Beacon。
   - Scene Panels、Pulse Terminal、Dialogue Capsules、Image Lab。
   - MDX schema 与内容渲染整合。
4. **Integration Sprint（Week 7）**
   - 首屏串联 + 文章长卷无缝铺陈。
   - 音画同步与线网全站连接。
   - QA：Playwright、Lighthouse、无障碍。
5. **Stabilization & CMS（Week 8）**
   - Sanity 接入验证、数据同步。
   - 性能调优、bundle 分析、监控布设。
   - 发布准备与文档更新。

---

#### 7. 组件任务矩阵

| 模块                                                    | 所属包            | 核心任务                 | 复用策略 |
| ------------------------------------------------------- | ----------------- | ------------------------ | -------- |
| Line Net 内核                                           | packages/line-net | DSL/动画/Hooks/SSR       | 新建     |
| Chrono Initiation Grid                                  | apps/web          | 预加载线网、节拍同步     | 重构     |
| Background Universe                                     | packages/motion   | 星云 shader、音频驱动    | 扩展复用 |
| Synthwave Skyline                                       | packages/motion   | 折线生成、周期刷新       | 新建     |
| Slogan Cluster 2.0                                      | apps/web          | 零面积文本、CTA 收束     | 重构     |
| Floating Audio Rail                                     | apps/web          | 播放条、波形、偏好       | 重构     |
| Constellation Index                                     | apps/web/ui       | 径向线网、列表展开       | 新建     |
| Timeline Beacon                                         | apps/web/ui       | 垂直主线、章节导航       | 新建     |
| Scene Panels/Pulse Terminal/Dialogue Capsules/Image Lab | packages/ui       | 零面积线框组件、MDX 集成 | 新建     |
| Echo Chamber/Author Glyph 更新                          | apps/web/ui       | 接入线网、音画响应       | 重构     |

---

#### 8. 测试与质量保障

- **自动化**：继续 ESLint/TS/Vitest；新增 line-net DSL 解析与动画调度单测。
- **Playwright**：覆盖 Chrono Initiation Grid、线网键盘导航、Scene Panel 滚动、Audio Rail 控制、Reduced Motion 路径。
- **Lighthouse CI**：初版阈值 Performance ≥ 65、Accessibility ≥ 95、Best Practices ≥ 90、SEO ≥ 95。
- **视觉回归**：Storybook + Chromatic，新增线网结构、Skyline 刷新、Scene Panel 等 story。
- **音画同步测试**：借助 Web Audio API 事件监听（Playwright Extension）验证节拍精度。

---

#### 9. 运维与监控

- Vercel 部署流程不变；`packages/line-net` 发布内部 npm 包。
- Sentry/Vercel Analytics 继续；新增线网状态 log（捕获动画失步）。
- 环境变量：音频资源、线网配置版本、Sanity key 等集中管理。

---

#### 10. 风险与缓解

1. **线网复杂度** → 分层渲染（主骨架优先、细节延迟）、Playground 调试工具、性能基准测试。
2. **音画同步偏差** → `tone.js` Transport 控制、回退到 CSS 动画、提供手动校准开关。
3. **性能瓶颈** → GPU Profiling、粒子/辉光可调、低配模式预留。
4. **无障碍风险** → 按线网顺序配置 Tab Index、统一 Focus 辉光、为节点补充 ARIA 描述、Reduced Motion 完整覆盖。

---

#### 11. 即刻执行清单

1. 初始化 `packages/line-net`（package.json、tsconfig、导出 API）。
2. 扩展 `packages/tokens`（线宽、角度、辉光、噪点、节拍 token），重新 build style-dictionary。
3. 升级 `@chrono/motion` Playground：新增 Synthwave Skyline Demo、线网可视化调试面板。
4. 在 `apps/web` 创建 `home/line-net.config.ts`，描述首页主干线拓扑。
5. 迁移旧组件至 `apps/web/components/legacy/`，添加 README 说明替代方案与淘汰计划。

---

#### 12. 结语

Chrono-Stasis 实现方案 2.0 面向零面积线网与 synthwave 叙事的新愿景，对现有代码全面升级：引入线网核心库、重构首屏沉浸体验、扩展 MDX 叙事模块、确保音画同步与无障碍可及。随着线网内核和核心组件的逐步落地，我们将把技术博客转化为脉动的光谱档案馆，为后续交互与内容扩展建立稳固的技术底座。
